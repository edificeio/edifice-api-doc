---
openapi: 3.0.0
info:
  title: Edifice - Statistics - API üößüöß
  description: This part represant the documentation of the Edifice api use in statistics module
  version: 4.10.0
servers:
  - url: /
tags:
  - name: stats
paths:
  /stats/list:
    get:
      tags:
        - stats
      summary: R√©cup√®re les statistiques
      description: Retourne les statistiques en fonction des param√®tres fournis.
      parameters:
        - name: indicator
          in: query
          required: true
          schema:
            type: string
            enum: ["accounts", "access"]
          description: Type d'indicateur √† r√©cup√©rer.
        - name: from
          in: query
          required: true
          schema:
            type: string
            format: date
          description: Date de d√©but.
        - name: to
          in: query
          required: false
          schema:
            type: string
            format: date
          description: Date de fin.
        - name: frequency
          in: query
          required: false
          schema:
            type: string
            enum: ["hour", "day", "week", "month"]
          description: Fr√©quence des donn√©es.
        - name: entityLevel
          in: query
          required: false
          schema:
            type: string
            enum: ["platform", "structure", "class", "tenant"]
          description: Niveau de l'entit√© concern√©e.
        - name: entity
          in: query
          required: false
          schema:
            type: string
          description: Identifiant de l'entit√©.
        - name: device
          in: query
          required: false
          schema:
            type: boolean
          description: Filtrer par appareil.
      responses:
        '200':
          description: Succ√®s, retourne les statistiques demand√©es.
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    entity_name:
                      type: string
                    uai:
                      type: string
                    id:
                      type: string
                    platform_id:
                      type: string
                    date:
                      type: string
                      format: date-time
                    structure_id:
                      type: string
                    profile:
                      type: string
                    type:
                      type: string
                    module:
                      type: string
                    access:
                      type: integer
                    unique_access_minute:
                      type: integer
                    unique_access:
                      type: integer
                    access_wta:
                      type: integer
                    unique_access_minute_wta:
                      type: integer
                    unique_access_wta:
                      type: integer
        '400':
          description: Requ√™te invalide (param√®tres manquants ou incorrects).
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: "invalid.params"
        '401':
          description: Non autoris√©
        '500':
          description: Erreur interne du serveur.

  /stats/export:
    get:
      tags:
        - stats
      summary: Exporte les statistiques selon les param√®tres sp√©cifi√©s.
      description: Cette requ√™te permet d'exporter les statistiques au format CSV, avec la possibilit√© de filtrer les r√©sultats par divers crit√®res.
      operationId: exportStats
      parameters:
        - name: indicator
          in: query
          description: Indicateur √† exporter.
          required: true
          schema:
            type: string
            enum: ["accounts", "access"]

        - name: from
          in: query
          description: Date de d√©but.
          required: true
          schema:
            type: string
            format: date

        - name: to
          in: query
          description: Date de fin. Si non sp√©cifi√©e, la date actuelle est utilis√©e.
          required: false
          schema:
            type: string
            format: date

        - name: frequency
          in: query
          description: Fr√©quence des donn√©es √† exporter
          required: false
          schema:
            type: string
            enum: ["hour", "day", "week", "month"]

        - name: entityLevel
          in: query
          description: Niveau d'entit√© des donn√©es √† exporter
          required: false
          schema:
            type: string
            enum: ["platform", "structure", "class", "tenant"]

        - name: entity
          in: query
          description: Identifiant de l'entit√© √† exporter.
          required: false
          schema:
            type: string

        - name: device
          in: query
          description: Filtrer les r√©sultats selon le type de dispositif.
          required: false
          schema:
            type: boolean

        - name: accumulate
          in: query
          required: false
          schema:
            type: string

        - name: substructures
          in: query
          description: Inclure les sous-structures dans les donn√©es export√©es.
          required: false
          schema:
            type: boolean

        - name: userClasses
          in: query
          description: Filtrer par les classes d'utilisateur.
          required: false
          schema:
            type: boolean

      responses:
        '200':
          description: L'export des donn√©es a √©t√© effectu√© avec succ√®s. Le fichier CSV sera t√©l√©charg√©.
          content:
            application/csv:
              schema:
              
        '400':
          description: Param√®tres manquants ou invalides dans la requ√™te.
        '401':
          description: Non autoris√©
        '500':
          description: Erreur interne du serveur lors de l'exportation des donn√©es.

  /stats/structures:
    get:
      tags:
        - stats
      summary: R√©cup√®re les informations des structures
      description: Retourne un tableau contenant les d√©tails des structures.
      responses:
        '200':
          description: Succ√®s, retourne un tableau de structures.
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    id:
                      type: string
                      format: uuid
                    name:
                      type: string
                    parents:
                      type: array
                      items:
                        type: object
                        properties:
                          name:
                            type: string
                          id:
                            type: string
                            format: uuid
                    classes:
                      type: string
                      nullable: true
                      example: null
                    notroot:
                      type: boolean
                      example: true
        '401':
          description: Non autoris√©
        '500':
          description: Erreur interne du serveur.